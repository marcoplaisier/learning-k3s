# ---------------------------------------------------------------------------
# Camel K IntegrationPlatform Configuration
# This defines how Camel K builds and runs integrations in the cluster
# ---------------------------------------------------------------------------
apiVersion: camel.apache.org/v1
kind: IntegrationPlatform
metadata:
  name: camel-k
  namespace: camel-k
  labels:
    app: camel-k
  annotations:
    argocd.argoproj.io/sync-wave: "4"
spec:
  build:
    # Build strategy for K3s - using pod (builds in-cluster)
    # Publish strategy Jib with in-cluster registry
    buildConfiguration:
      strategy: pod
    publishStrategy: Jib
    registry:
      # Use service DNS name (accessible from build pods)
      # registries.yaml will redirect pulls to localhost:30500
      address: registry.registry:5000
      organization: camel-k
      insecure: true
    timeout: 5m
  cluster: Kubernetes
  profile: Kubernetes
